<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>Docker 学习日记 Day1 | FogDong&#39;s blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Docker," />
  

  <meta name="description" content="基本概念三个基本概念 镜像 Image 容器 Container 仓库 Repository  关于镜像： 不包含任何动态数据，其内容在构建后不会改变 多层文件  关于容器： 和镜像相当于是类和实例的关系 容器存储层不写入任何数据，文件写入操作应使用数据卷 数据卷的生存周期独立于容器  关于仓库： Repository:Tag 的形式，若不给出标签，将以 latest 作为默认标签   安装及配置">
<meta name="keywords" content="Docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 学习日记 Day1">
<meta property="og:url" content="http://yoursite.com/2017/07/07/Docker 学习日记 Day1/index.html">
<meta property="og:site_name" content="FogDong&#39;s blog">
<meta property="og:description" content="基本概念三个基本概念 镜像 Image 容器 Container 仓库 Repository  关于镜像： 不包含任何动态数据，其内容在构建后不会改变 多层文件  关于容器： 和镜像相当于是类和实例的关系 容器存储层不写入任何数据，文件写入操作应使用数据卷 数据卷的生存周期独立于容器  关于仓库： Repository:Tag 的形式，若不给出标签，将以 latest 作为默认标签   安装及配置">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499414567862.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499412887568.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499414323968.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499414958623.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499415253765.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499415765707.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499425658053.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499427879034.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499427948376.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499428552864.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499428712734.png">
<meta property="og:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499428728572.png">
<meta property="og:updated_time" content="2018-12-25T12:54:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker 学习日记 Day1">
<meta name="twitter:description" content="基本概念三个基本概念 镜像 Image 容器 Container 仓库 Repository  关于镜像： 不包含任何动态数据，其内容在构建后不会改变 多层文件  关于容器： 和镜像相当于是类和实例的关系 容器存储层不写入任何数据，文件写入操作应使用数据卷 数据卷的生存周期独立于容器  关于仓库： Repository:Tag 的形式，若不给出标签，将以 latest 作为默认标签   安装及配置">
<meta name="twitter:image" content="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499414567862.png">

  

  
    <link rel="icon" href="/images/crown.png">
  

  <link href="/css/styles.css?v=028c63b1" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>
<body>
<canvas id="starlight"></canvas>

  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#三个基本概念"><span class="toc-text">三个基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于镜像："><span class="toc-text">关于镜像：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于容器："><span class="toc-text">关于容器：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于仓库："><span class="toc-text">关于仓库：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装及配置"><span class="toc-text">安装及配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Docker"><span class="toc-text">安装 Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置加速器"><span class="toc-text">配置加速器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#尝试着运行一个-Nginx-服务器"><span class="toc-text">尝试着运行一个 Nginx 服务器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用镜像"><span class="toc-text">使用镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#获取镜像"><span class="toc-text">获取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用容器"><span class="toc-text">使用容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#列出镜像"><span class="toc-text">列出镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定制镜像"><span class="toc-text">定制镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-Dockerfile-定制镜像"><span class="toc-text">使用 Dockerfile 定制镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构建镜像"><span class="toc-text">构建镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他-docker-build-的用法"><span class="toc-text">其他 docker build 的用法</span></a></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-Docker 学习日记 Day1" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Docker 学习日记 Day1</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.07.07</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>FogDong</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Docker/">Docker</a>
  </span>



      
        <span>
          <i class="icon-comment"></i>
          <a href="https://fogdong.github.io//2017/07/07/Docker 学习日记 Day1/#disqus_thread"></a>
        </span>
      

    </div>
  </header>

  <div class="article-content">
    
      <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="三个基本概念"><a href="#三个基本概念" class="headerlink" title="三个基本概念"></a>三个基本概念</h3><ul>
<li>镜像 Image</li>
<li>容器 Container</li>
<li>仓库 Repository</li>
</ul>
<h3 id="关于镜像："><a href="#关于镜像：" class="headerlink" title="关于镜像："></a>关于镜像：</h3><ol>
<li>不包含任何动态数据，其内容在构建后不会改变</li>
<li>多层文件</li>
</ol>
<h3 id="关于容器："><a href="#关于容器：" class="headerlink" title="关于容器："></a>关于容器：</h3><ol>
<li>和镜像相当于是类和实例的关系</li>
<li>容器存储层不写入任何数据，文件写入操作应使用数据卷</li>
<li>数据卷的生存周期独立于容器</li>
</ol>
<h3 id="关于仓库："><a href="#关于仓库：" class="headerlink" title="关于仓库："></a>关于仓库：</h3><ol>
<li>Repository:Tag 的形式，若不给出标签，将以 latest 作为默认标签</li>
</ol>
<hr>
<h2 id="安装及配置"><a href="#安装及配置" class="headerlink" title="安装及配置"></a>安装及配置</h2><h3 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h3><p><code>brew cask intall docker</code></p>
<h3 id="配置加速器"><a href="#配置加速器" class="headerlink" title="配置加速器"></a>配置加速器</h3><blockquote>
<p>由于访问较慢，国内的一些云服务商提供了针对 Docker Hub 的镜像服务（Registry Mirror），这些镜像服务被称为加速器。</p>
</blockquote>
<p>Mac 10.10.3 以上直接用 Docker for Mac 配置加速器，用了阿里云的镜像站点</p>
<h3 id="尝试着运行一个-Nginx-服务器"><a href="#尝试着运行一个-Nginx-服务器" class="headerlink" title="尝试着运行一个 Nginx 服务器"></a>尝试着运行一个 Nginx 服务器</h3><p><code>docker run -d -p 80:80 –name webserver<br>nginx</code><br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499414567862.png" alt="Alt text"></p>
<blockquote>
<p>由此可以看出分层存储的概念，下载也是一层层的下载，而非单一文件。下载过程中给出了每一层的 ID 的前 12 位。并且下载结束后，给出该镜像完整的 sha256 的摘要，以确保下载一致性。</p>
</blockquote>
<p>访问 localhost<br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499412887568.png" alt="Alt text"><br>没有出错，停止服务器并删除<br><code>docker stop webserver</code><br><code>docker rm webserver</code></p>
<hr>
<h2 id="使用镜像"><a href="#使用镜像" class="headerlink" title="使用镜像"></a>使用镜像</h2><blockquote>
<p>Docker 运行容器前需要本地存在对应的镜像，如果镜像不存在本地，Docker 会从镜像仓库下载（默认是 Docker Hub 公共注册服务器中的仓库）</p>
</blockquote>
<h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h3><p>从 <a href="https://hub.docker.com/explore/" target="_blank" rel="external">Docker Hub</a> 上可获取大量高质量镜像<br>从 Docker Registry 获取镜像命令 <code>docker pull</code><br><code>docker pull –help</code>查看用法<br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499414323968.png" alt="Alt text"></p>
<blockquote>
<p> Docker Registry 地址：地址的格式一般是 &lt;域名/IP&gt;[:端口号]。默认地址是 Docker Hub。<br>仓库名：如之前所说，这里的仓库名是两段式名称，既 &lt;用户名&gt;/&lt;软件名&gt;。对于 Docker Hub，如果不给出用户名，则默认为 library，也就是官方镜像。</p>
</blockquote>
<p>获取一个最新版本的 ubuntu 镜像<br><code>docker pull ubuntu</code><br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499414958623.png" alt="Alt text"></p>
<blockquote>
<p>上面的命令中没有给出 Docker Registry 地址，因此将会从 Docker Hub 获取官方镜像 library/ubuntu 仓库中最新版本的镜像。</p>
</blockquote>
<h3 id="使用容器"><a href="#使用容器" class="headerlink" title="使用容器"></a>使用容器</h3><p>用刚才下载的 ubuntu 镜像来启动一个容器<br><code>docker run -it –rm ubuntu bash</code><br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499415253765.png" alt="Alt text"></p>
<ul>
<li><code>docker run</code>： 运行容器的命令</li>
<li><code>–it</code>： 这是两个参数，一个是 <code>-i</code> 交互式操作，一个是 <code>-t</code> 终端。我们这里打算进入 bash 执行一些命令并查看返回结果，因此我们需要交互式终端。</li>
<li><code>–rm</code>：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需求，退出的容器并不会立即删除，除非手动 <code>docker rm</code> 。我们这里只是随便执行个命令，看看结果，不需要排障和保留结果，因此使用 <code>–rm</code> 可以避免浪费空间</li>
<li><code>ubuntu</code>：用 <code>ubuntu</code> 镜像为基础来启动容器</li>
<li><code>bash</code>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 <code>bash</code></li>
</ul>
<h3 id="列出镜像"><a href="#列出镜像" class="headerlink" title="列出镜像"></a>列出镜像</h3><p><code>docker images</code><br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499415765707.png" alt="Alt text"></p>
<ul>
<li>镜像体积：Docker Hub 中显示的体积是压缩后的体积，在镜像下载和上传过程中镜像是保持着压缩状态的，因此 Docker Hub 所显示的大小是网络传输中更关心的流量大小。而 docker images 显示的是镜像下载到本地后，展开的大小</li>
</ul>
<blockquote>
<p>由于 Docker 镜像是多层存储结构，并且可以继承、复用，因此不同镜像可能会因为使用相同的基础镜像，从而拥有共同的层。由于 Docker 使用 Union FS，相同的层只需要保存一份即可，因此实际镜像硬盘占用空间很可能要比这个列表镜像大小的总和要小的多。</p>
</blockquote>
<ul>
<li>虚悬镜像：由于新旧镜像同名，旧镜像名称被取消，从而出现仓库名、标签均为 <none> 的镜像。这类无标签镜像也被称为 虚悬镜像(dangling image)，一般来说，虚悬镜像已经失去了存在的价值，是可以随意删除的</none></li>
<li>中间层镜像：为了加速镜像构建、重复利用资源，Docker 会利用 中间层镜像，并且相同的层只会存储一遍</li>
<li>列出部分镜像：过滤器参数 <code>–filter</code>，或者简写 <code>-f</code>，用于筛选镜像。 <code>–format</code> 格式化筛选镜像</li>
</ul>
<h3 id="定制镜像"><a href="#定制镜像" class="headerlink" title="定制镜像"></a>定制镜像</h3><p>用 nginx 镜像启动一个容器并命名为 webserver<br><code>docker run –name webserver -d -p 80:80 nginx</code></p>
<blockquote>
<p>-d：以守护进程方式运行（后台）<br>-p &lt; HOT_PORT &gt; : &lt; CONTAINER_PORT &gt;：指定端口号</p>
</blockquote>
<p>可在 localhost 访问 nginx 主页<br>若想修改主页内容，则<br><code>docker exec -it webserver bash</code><br>我们修改了容器的文件，即修改了容器的存储层<br>通过<code>docker diff webserver</code>查看具体的改动<br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499425658053.png" alt="Alt text"><br>若要用commit方式保存为镜像则<br><code>docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</code></p>
<blockquote>
<p>使用 docker commit 意味着所有对镜像的操作都是黑箱操作，生成的镜像也被称为黑箱镜像。所以，慎用 docker commit</p>
</blockquote>
<h3 id="使用-Dockerfile-定制镜像"><a href="#使用-Dockerfile-定制镜像" class="headerlink" title="使用 Dockerfile 定制镜像"></a>使用 Dockerfile 定制镜像</h3><p>Dockerfile 的实质是一个脚本文件，其内包含了一条条的指令(Instruction)，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</p>
<p>在一个<strong>空白目录</strong>中，建立一个文本文件，并命名为 Dockerfile</p>
<blockquote>
<p>空白目录非常重要，因为上下文所在的整个文件夹（包括子文件夹）是会被打包上传到docker server的。看的时候一直不明白上下文是什么意思，查了官方文档，原话是这样的。<br>it’s best to start with an empty directory as <strong>context</strong> and keep your Dockerfile in that directory. Add only the files needed for building the Dockerfile.<br>这里的上下文也就是context</p>
</blockquote>
<p><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499427879034.png" alt="Alt text"><br>Dockerfile的内容为<br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499427948376.png" alt="Alt text"></p>
<ul>
<li><code>FROM</code>：指定基础镜像。<code>scratch</code>表示空白镜像</li>
<li><code>RUN</code>：执行命令。</li>
</ul>
<blockquote>
<p>RUN执行命令的两种格式：</p>
<ol>
<li>shell 格式：<code>RUN &lt;命令&gt;</code></li>
<li>exec 格式：<code>RUN [“可执行文件”, “参数1”, “参数2”]</code></li>
</ol>
</blockquote>
<p>每一次 <code>RUN</code> 都会建立一层，所以如果用 shell 格式，要用 <code>&amp;&amp;</code>  将各个所需命令串联起来，可用 <code>\</code> 命令换行使代码易读。在镜像构建时，一定要确保每一层只添加真正需要添加的东西，任何无关的东西都应该清理掉。</p>
<h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p><code>docker build [选项] &lt;上下文路径/URL/-&gt;</code><br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499428552864.png" alt="Alt text"></p>
<p>运行一下容器看一下是否出错<br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499428712734.png" alt="Alt text"><br><img src="http://ok2ra0say.bkt.clouddn.com/2017-7-7/1499428728572.png" alt="Alt text"></p>
<h3 id="其他-docker-build-的用法"><a href="#其他-docker-build-的用法" class="headerlink" title="其他 docker build 的用法"></a>其他 docker build 的用法</h3><ol>
<li>直接用 Git repo 进行构建</li>
<li>用给定的 tar 压缩包构建</li>
<li>从标准输入中读取 Dockerfile 进行构建</li>
<li>从标准输入中读取上下文压缩包进行构建</li>
</ol>

    
  </div>
</article>

</div>






  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'fogdong';
    
    var disqus_url = 'http://yoursite.com/2017/07/07/Docker 学习日记 Day1/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//fogdong.disqus.com/count.js" async></script>



    




  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
